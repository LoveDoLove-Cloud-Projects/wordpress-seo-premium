(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.lodash,s=window.wp.blocks,r=window.wp.blockEditor,o=window.wp.components,a=window.wp.data,n=window.wp.element,i=window.wp.i18n,l=window.yoast.aiFrontend,u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"version":"23.0","name":"yoast-seo/ai-summarize","title":"Yoast AI Summarize","description":"Adds a short AI summary of your content.","category":"yoast-ai-blocks","icon":"editor-ul","keywords":["summary","tldr","key takeaways"],"textdomain":"wordpress-seo-premium","attributes":{"title":{"type":"string","source":"html","selector":"h1,h2,h3,h4,h5,h6","default":"Key Takeaways"},"level":{"type":"number","default":2},"status":{"type":"string","default":"idle"}},"allowedBlocks":["core/list","core/list-item"],"supports":{"html":true,"multiple":false},"example":{"attributes":{"title":"Key Takeaways","level":2,"status":"loaded"},"innerBlocks":[{"name":"core/list","innerBlocks":[{"name":"core/list-item","attributes":{"content":"First key takeaway from the content"}},{"name":"core/list-item","attributes":{"content":"Second important point to remember"}},{"name":"core/list-item","attributes":{"content":"Third summary point for quick reference"}}]}]}}'),c="yoast-seo/editor",d={blockEditor:"core/block-editor"},m="loading",p=((0,i.__)("AI - Keyphrase density","wordpress-seo-premium"),(0,i.__)("Use keyphrase words in the text frequently but not excessively.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase in introduction","wordpress-seo-premium"),(0,i.__)("Include words from the keyphrase in the first paragraph of the text.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase distribution","wordpress-seo-premium"),(0,i.__)("Evenly distribute keyphrase words throughout the text.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase in subheadings","wordpress-seo-premium"),(0,i.__)("Include at least one word from the keyphrase in each subheading.","wordpress-seo-premium"),(0,i.__)("AI - Sentence length","wordpress-seo-premium"),(0,i.__)("Ensure long sentences are shortened or split for better readability.","wordpress-seo-premium"),(0,i.__)("AI - Paragraph length","wordpress-seo-premium"),(0,i.__)("Ensure long paragraphs are shortened or split for better readability.","wordpress-seo-premium"),"yoast-seo/ai-generator"),y="yoast-seo-premium/ai-summarize",h=["core/paragraph","core/heading","core/list-item","core/table","core/details","core/media-text","core/freeform","core/preformatted","yoast/faq-block","yoast/how-to-block"],g=window.yoast.reduxJsToolkit,w="generatedSummary",b=(0,g.createSlice)({name:w,initialState:{status:m,error:{code:200,message:"",errorIdentifier:""},summary:{title:"Key Takeaways",points:[]}},reducers:{setLoading:e=>{e.status=m},setSuccess:(e,{payload:t})=>{e.status="success",e.summary.points=t.data},setError:(e,{payload:t})=>{e.status="error",e.error=t},updateSummaryPoint:(e,{payload:t})=>{const{index:s,content:r}=t;e.summary.points[s]&&(e.summary.points[s]=r)},updateSummaryTitle:(e,{payload:t})=>{e.summary.title=t},updateSummaryPoints:(e,{payload:t})=>{e.summary.points=t}}}),k=b.getInitialState,f={selectGeneratedSummary:e=>(0,t.get)(e,w,""),getSummaryPoints:e=>(0,t.get)(e,[w,"summary","points"],[]),getSummaryTitle:e=>(0,t.get)(e,[w,"summary","title"],""),getFetchError:e=>(0,t.get)(e,[w,"error"],{})},x=b.actions,S=b.reducer,_="promptContentSummarize",j=(0,g.createSlice)({name:_,initialState:{text:"",length:0},reducers:{setPromptContentSummarize:(e,{payload:t})=>t}}),C=j.getInitialState,v={selectPromptContentSummarize:e=>(0,t.get)(e,_,"")},B=j.actions,E=j.reducer,I="AISummarizeButton",M=(0,g.createSlice)({name:I,initialState:{disabledAIButtons:!1},reducers:{disableAISummarizeButtons:(e,{payload:t})=>{e.disabledAIButtons=t}}}),A=M.getInitialState,R={getDisabledAISummarizeButtons:e=>(0,t.get)(e,[I,"disabledAIButtons"],!1)},L=M.actions,T=M.reducer,z=window.React,P=z.forwardRef((function(e,t){return z.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"}))})),q=window.yoast.propTypes;var F=e.n(q);const O=window.ReactJSXRuntime,N=()=>(0,O.jsxs)("div",{className:"yst-flex yst-items-center yst-gap-2",children:[(0,O.jsx)(o.Spinner,{}),(0,O.jsx)("span",{children:(0,i.__)("Summary is being generated...","wordpress-seo-premium")})]}),G=(e,t)=>{try{return(0,n.createInterpolateElement)(e,t)}catch(t){return console.error("Error in translation for:",e,t),e}},U=()=>(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{children:(0,i.__)("Generate a quick summary highlighting the main takeaways from your content.","wordpress-seo-premium")}),(0,O.jsx)("div",{children:(0,i.__)("We suggest placing the summary at the top of your article to help busy readers quickly understand the value.","wordpress-seo-premium")}),(0,O.jsx)("div",{children:G((0,i.__)("<em><strong>Tip: </strong>For the most accurate summary, finalize your content before generating the summary.</em>","wordpress-seo-premium"),{em:(0,O.jsx)("em",{}),strong:(0,O.jsx)("strong",{})})})]}),D=({loading:e,onGenerate:t,isUsageCountLoading:s})=>{const{counts:r,limit:n,disableAIButtons:u}=(0,a.useSelect)((e=>({counts:e(p).selectUsageCount(),limit:e(p).selectUsageCountLimit(),disableAIButtons:e(y).getDisabledAISummarizeButtons()})),[]);return(0,O.jsxs)(o.Placeholder,{label:(0,i.__)("AI Summarize","wordpress-seo-premium"),icon:"editor-ul",children:[e&&(0,O.jsx)(N,{}),!e&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(U,{}),(0,O.jsx)("div",{className:"yst-mt-1",children:(0,O.jsxs)(o.Button,{id:"yst-ai-summarize-btn",className:"yst-w-full yst-flex yst-items-center yst-gap-2"+(u?" yst-opacity-50":""),onClick:t,isPrimary:!0,disabled:u,children:[(0,O.jsx)(P,{className:"yst-inline-block yst-align-middle yst-fill-none yst-w-4 yst-h-4"}),(0,O.jsx)("span",{children:(0,i.__)("Generate summary","wordpress-seo-premium")})]})}),(0,O.jsxs)("div",{className:"yst-flex yst-items-center yst-gap-2",children:[(0,O.jsx)("div",{className:"yst-relative",children:(0,O.jsx)(l.UsageCounter,{className:"yst-root"+(s?" yst-mb-4":""),limit:n,requests:r,isSkeleton:s})}),!s&&(0,O.jsx)("p",{className:"yst-text-slate-500",children:G((0,i.__)("<em>You're about to use 1 spark.</em>","wordpress-seo-premium"),{em:(0,O.jsx)("em",{})})})]})]})]})};D.propTypes={loading:F().bool.isRequired,onGenerate:F().func.isRequired,isUsageCountLoading:F().bool.isRequired};const K=({level:e,title:t,setAttributes:s})=>{const{updateSummaryTitle:o}=(0,a.useDispatch)(y),l=(0,n.useCallback)((e=>{s({title:e}),o(e)}),[s]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(r.RichText,{tagName:`h${e}`,value:t||(0,i.__)("Key Takeaways","wordpress-seo-premium"),onChange:l}),(0,O.jsx)(r.InnerBlocks,{template:[["core/list",{className:"yoast-ai-summarize-list"}]],templateLock:"all"})]})};K.propTypes={level:F().number.isRequired,title:F().string.isRequired,setAttributes:F().func.isRequired};const H=["core/quote","core/cover"],V=(e,t)=>e.reduce(((e,r)=>H.includes(r.name)||(e=>{var t;return!(t=(0,s.getBlockContent)(e),(new DOMParser).parseFromString(t,"text/html").documentElement.textContent).trim()})(r)?e:t.includes(r.name)?[...e,r]:r.innerBlocks.length>0?[...e,...V(r.innerBlocks,t)]:e),[]),W={ja:e=>Math.round(e.length/2),default:e=>Math.round(e.length/4)},J=e=>{const{setOnStore:t,activeMarker:r}=e;if(r)return;const o=(()=>{const{getBlocks:e}=(0,a.select)(d.blockEditor),t=V(e(),h).map((e=>(0,s.getBlockContent)(e))).join("\n");return{text:t,length:(e=>{const t=(0,a.select)(c).getContentLocale();return(W[t]||W.default)(e)})(t)}})();(e=>{const{disableAISummarizeButtons:t}=(0,a.dispatch)(y);t(e<200||e>1e4)})(o.length),t(o)},Y=()=>{const{getActiveMarker:e}=(0,a.select)(c),{setPromptContentSummarize:t}=(0,a.dispatch)(y);return()=>{const s=e();J({setOnStore:t,activeMarker:s})}},$=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.FeatureError",t.noop),Q=({isFeatureErrorModalOpen:e,aiModalHelperLink:t,onClose:s})=>{const{currentSubscriptions:r}=(0,a.useSelect)((e=>({currentSubscriptions:e(p).selectProductSubscriptions()})),[]);return(0,O.jsx)(l.ErrorModal,{title:(0,i.__)("AI Summary","wordpress-seo-premium"),isOpen:e,badgeText:(0,i.__)("Beta","wordpress-seo-premium"),aiModalHelperLink:t,onClose:s,children:(0,O.jsx)($,{currentSubscriptions:r})})};Q.propTypes={isFeatureErrorModalOpen:F().bool.isRequired,aiModalHelperLink:F().string.isRequired,onClose:F().func.isRequired};const X=window.yoast.uiLibrary,Z=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.Introduction",t.noop),ee=({shouldOpen:e,handleClose:t,handleStartGenerating:s,initialFocus:r})=>{const o=(0,i.__)("Close modal","wordpress-seo-premium");return(0,O.jsx)(X.Modal,{className:"yst-introduction-modal",isOpen:e,onClose:t,initialFocus:r,children:(0,O.jsx)(X.Modal.Panel,{className:"yst-max-w-lg yst-p-0 yst-rounded-3xl",closeButtonScreenReaderText:o,children:(0,O.jsx)(Z,{onStartGenerating:s})})})};ee.propTypes={shouldOpen:F().bool.isRequired,handleClose:F().func.isRequired,handleStartGenerating:F().func.isRequired,initialFocus:F().object.isRequired};const te=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.SuggestionError",t.noop),se=(0,t.get)(u,"example",{});window.jQuery(window).on("YoastSEO:ready",(()=>{Y(),(0,a.subscribe)((0,t.debounce)((()=>{const{getEditorDataContent:e}=(0,a.select)(c),s=(0,t.get)(window,"yoast.editorModules.helpers.createWatcher",t.noop),r=Y();return setTimeout(r,1500),s(e,r)})(),1500,{maxWait:3e3}))})),((e={})=>{(0,a.register)((e=>(0,a.createReduxStore)(y,{actions:{...x,...B,...L},selectors:{...f,...v,...R},initialState:(0,t.merge)({},{[w]:k(),[_]:C(),[I]:A()},e),reducer:(0,a.combineReducers)({[w]:S,[_]:E,[I]:T})}))(e))})(),(0,s.registerBlockType)(u,{edit({attributes:e,setAttributes:u,clientId:m}){const{title:h,level:g,status:w}=e,{fetchUsageCount:b}=(0,a.useDispatch)(p),{removeBlock:k}=(0,a.useDispatch)(d.blockEditor),{usageCountEndpoint:f,hasConsent:x,hasValidPremiumSubscription:S,aiModalHelperLink:_,disableAIButtons:j,summary:C,block:v,fetchError:B}=(0,a.useSelect)((e=>({usageCountEndpoint:e(p).selectUsageCountEndpoint(),disableAIButtons:e(y).getDisabledAISummarizeButtons(),summary:e(y).getSummaryPoints(),block:e(d.blockEditor).getBlock(m),hasConsent:e(p).selectHasAiGeneratorConsent(),hasValidPremiumSubscription:e(p).selectPremiumSubscription(),aiModalHelperLink:e(c).selectLink("https://yoa.st/ai-summarize-help-button"),fetchError:e(y).getFetchError()})),[]),[E,I]=(0,n.useState)(!1),[M,A]=(0,n.useState)(!1),[R,L]=(0,n.useState)(!x&&S),[T,z]=(0,n.useState)(!1),[P,q]=(0,n.useState)(!1),F=(0,n.useRef)(null),N=(0,r.useBlockProps)({className:"yoast-ai-summarize"}),G=(0,n.useRef)(!1),U=(0,n.useCallback)((async()=>{if(!S)return void q(!0);if(!x)return void L(!0);I(!0),u({status:"loading"});const e=await(async()=>{const e=(0,t.get)(window,"yoast.editorModules.aiGenerator.helpers.fetchSuggestions",t.noop),s=(0,t.get)(window,"yoast.editorModules.aiGenerator.helpers.removesLocaleVariantSuffixes",t.noop),{fetchUsageCount:r}=(0,a.dispatch)(p),o=(0,a.select)(p).selectUsageCountEndpoint(),n=(0,a.select)(c).getContentLocale(),i=(0,a.select)(c).getFocusKeyphrase(),l=(0,a.select)(y).selectPromptContentSummarize().text,{setLoading:u,setError:d,setSuccess:m}=(0,a.dispatch)(y);u();const{status:h,payload:g}=await e({endpoint:"yoast/v1/ai/summarize",canAbort:!0,data:{language:s(n).replace("_","-"),focus_keyphrase:i,prompt_content:l}});switch(h){case"abort":break;case"error":d(g);break;case"success":g?(m({data:g}),r({endpoint:o})):d(g)}return{summary:g,status:h}})();"success"===e.status?(G.current=!0,u({status:"loaded"}),z(!1)):"error"===e.status&&(z(!0),u({status:"failed"})),I(!1)}),[I,u,x]),H=v.innerBlocks,V=H.find((e=>"core/list"===e.name)),W=(0,n.useMemo)((()=>{var e,s;if(!V||!V.innerBlocks.length)return!1;const r=V.innerBlocks[0];return(0,t.isEqual)(v.attributes,se.attributes)&&"First key takeaway from the content"===(null==r||null===(e=r.attributes)||void 0===e||null===(s=e.content)||void 0===s?void 0:s.text)}),[v,e]);(0,n.useEffect)((()=>{let e=!0;return f&&!W&&x&&"loaded"!==w&&(A(!0),b({endpoint:f}).then((({type:t,payload:s})=>{if(e)if("fetchUsageCount/success"===t)A(!1);else if("fetchUsageCount/error"===t){const{errorMessage:e}=s;"CONSENT_REVOKED"===e&&L(!0)}}))),()=>{e=!1,A(!1)}}),[b,f,x]);const{updateSummaryPoints:J}=(0,a.useDispatch)(y),{replaceInnerBlocks:Y}=(0,a.useDispatch)(d.blockEditor),$=(0,n.useMemo)((()=>!x&&S&&R&&"loaded"!==w),[x,S,R]),X=(0,n.useCallback)((()=>{L(!1),x||k(m)}),[L,x]),Z=(0,n.useCallback)((()=>{A(!1),L(!1)}),[L]),re=(0,n.useMemo)((()=>!S),[S]);(0,n.useEffect)((()=>{re&&q(!0)}),[re]);const oe=(0,n.useMemo)((()=>re&&"loaded"!==w),[re,w]),ae=(0,n.useMemo)((()=>T&&x&&"loaded"!==w),[T,x,w]),ne=(0,n.useCallback)((()=>{z(!1),q(!1)}),[z]),ie=(0,n.useCallback)((()=>{U(),ne()}),[U,ne]);(0,n.useEffect)((()=>{if(!V||"loaded"!==w)return;const e=V.innerBlocks.map((e=>{const t=e.attributes.content;return"string"==typeof t?t:t.text})).filter((e=>e&&""!==e));if(C.length){if(!(0,t.isEqual)(e,C))if(G.current){const e=C.map((e=>(0,s.createBlock)("core/list-item",{content:e})));Y(V.clientId,e,!1),G.current=!1}else J(e)}else e.length&&J(e)}),[w,C,H,J]);const le=(0,n.useMemo)((()=>W||"loaded"===w&&!E&&(!re&&x||C.length>0)),[W,w,E,re,x,C.length]),ue=(0,n.useCallback)((e=>u({level:e})),[u]);return(0,O.jsxs)(O.Fragment,{children:["loaded"===w&&!E&&(0,O.jsx)(r.BlockControls,{children:(0,O.jsxs)(o.ToolbarGroup,{children:[(0,O.jsx)(o.ToolbarButton,{icon:"update",label:"Regenerate summary",onClick:U,disabled:E||j||!x||!S,children:(0,i.__)("Regenerate summary","wordpress-seo-premium")}),(0,O.jsx)(r.HeadingLevelDropdown,{value:g,options:[1,2,3,4,5,6],onChange:ue})]})}),(0,O.jsx)(r.InspectorControls,{children:(0,O.jsx)(o.PanelBody,{title:(0,i.__)("About this block","wordpress-seo-premium"),className:"yoast-ai-summarize-controls",children:(0,O.jsx)("p",{children:(0,i.__)("Create a concise summary of your post, highlighting the key takeaways for your readers.","wordpress-seo-premium")})})}),(0,O.jsxs)("div",{...N,children:[le&&(0,O.jsx)(K,{level:g,title:h,setAttributes:u}),"loaded"!==w&&(0,O.jsx)(D,{loading:E,onGenerate:U,isUsageCountLoading:M}),(0,O.jsx)(l.ErrorModal,{title:(0,i.__)("AI Summary","wordpress-seo-premium"),badgeText:(0,i.__)("Beta","wordpress-seo-premium"),isOpen:ae,onClose:ne,aiModalHelperLink:_,children:(0,O.jsx)(te,{errorCode:B.code,errorIdentifier:B.errorIdentifier,invalidSubscriptions:B.missingLicenses,showActions:!0,onRetry:ie,errorMessage:B.message})}),oe&&(0,O.jsx)(Q,{isFeatureErrorModalOpen:P,aiModalHelperLink:_,onClose:ne}),$&&(0,O.jsx)(ee,{shouldOpen:R,handleStartGenerating:Z,initialFocus:F,handleClose:X})]})]})},save({attributes:e}){const{title:t,level:s,status:o}=e;if("loaded"!==o)return null;const a=r.useBlockProps.save({className:"yoast-ai-summarize"});return(0,O.jsxs)("div",{...a,children:[(0,O.jsx)(r.RichText.Content,{tagName:`h${s}`,value:t||(0,i.__)("Key Takeaways","wordpress-seo-premium")}),(0,O.jsx)(r.InnerBlocks.Content,{})]})}})})();